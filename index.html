<!DOCTYPE html>
<html lang="en">

<head>
    <!-- META SECTION -->
    <title>Techolution - Micro Climate Monitoring</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <!-- END META SECTION -->

    <!-- CSS INCLUDE -->
    <link rel="stylesheet" type="text/css" id="theme" href="css/theme-default.css" />
	<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
    <!-- EOF CSS INCLUDE -->
	<style>
	  #map {
        height: 270px;
      }
	    </style>
</head>

<body>
    <!-- START PAGE CONTAINER -->
    <div class="page-container">

        <!-- START PAGE SIDEBAR -->
        <div class="page-sidebar">
            <!-- START X-NAVIGATION -->
            <ul class="x-navigation">
                <li class="xn-logo">
                    <!-- <a href="index.html">MC Admin</a> -->
                    <img src="/images/techolution_logo.png" width="200" height="50" align="middle" style="margin:0px 8px">
                    <a href="#" class="x-navigation-control"></a>
                </li>
                <li class="xn-profile">
                    <a href="#" class="profile-mini">
                        <img src="/images/users/no-image.jpg" alt="John Doe" />
                    </a>
                    <div class="profile">
                        <div class="profile-image">
                            <img src="/images/users/no-image.jpg" alt="John Doe" />
                        </div>
                        <div class="profile-data">
                            <div class="profile-data-name">Admin</div>
                            <div class="profile-data-title">Control Center</div>
                        </div>
                        <div class="profile-controls">
                            <a href="" class="profile-control-left"><span class="fa fa-info"></span></a>
                            <a href="" class="profile-control-right"><span class="fa fa-envelope"></span></a>
                        </div>
                    </div>
                </li>
                <li class="xn-title">Navigation</li>
                <li class="active">
                    <a href="index.html"><span class="fa fa-desktop"></span> <span class="xn-text">Dashboard</span></a>
                </li>

            </ul>
            <!-- END X-NAVIGATION -->
        </div>
        <!-- END PAGE SIDEBAR -->



        <!-- PAGE CONTENT -->
        <div class="page-content">

            <!-- START X-NAVIGATION VERTICAL -->
            <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
                <!-- TOGGLE NAVIGATION -->
                <li class="xn-icon-button">
                    <a href="#" class="x-navigation-minimize"><span class="fa fa-dedent"></span></a>
                </li>
                <!-- END TOGGLE NAVIGATION -->
                <!-- SEARCH -->
                <li class="xn-search">
                    <form role="form">
                        <input type="text" name="search" placeholder="Search..." />
                    </form>
                </li>
                <!-- END SEARCH -->
                <!-- SIGN OUT -->
                <li class="xn-icon-button pull-right">
                    <a href="#" class="mb-control" data-box="#mb-signout"><span class="fa fa-sign-out"></span></a>
                </li>
                <!-- END SIGN OUT -->
                <!-- MESSAGES -->
                <li class="xn-icon-button pull-right">
                    <a href="#"><span class="fa fa-comments"></span></a>
                    <div class="informer informer-danger">4</div>
                    <div class="panel panel-primary animated zoomIn xn-drop-left xn-panel-dragging">
                        <div class="panel-heading">
                            <h3 class="panel-title"><span class="fa fa-comments"></span> Messages</h3>
                            <div class="pull-right">
                                <span class="label label-danger">4 new</span>
                            </div>
                        </div>

                        <div class="panel-footer text-center">
                            <a href="pages-messages.html">Show all messages</a>
                        </div>
                    </div>
                </li>
                <!-- END MESSAGES -->
                <!-- TASKS -->
                <li class="xn-icon-button pull-right">
                    <a href="#"><span class="fa fa-tasks"></span></a>
                    <div class="informer informer-warning">3</div>
                    <div class="panel panel-primary animated zoomIn xn-drop-left xn-panel-dragging">
                        <div class="panel-heading">
                            <h3 class="panel-title"><span class="fa fa-tasks"></span> Tasks</h3>
                            <div class="pull-right">
                                <span class="label label-warning">3 active</span>
                            </div>
                        </div>

                        <div class="panel-footer text-center">
                            <a href="pages-tasks.html">Show all tasks</a>
                        </div>
                    </div>
                </li>
                <!-- END TASKS -->
            </ul>
            <!-- END X-NAVIGATION VERTICAL -->

            <!-- START BREADCRUMB -->
            <ul class="breadcrumb">
                <li><a href="#">Home</a>
                </li>
                <li class="active">Dashboard</li>
            </ul>
            <!-- END BREADCRUMB -->

            <!-- PAGE CONTENT WRAPPER -->
            <div class="page-content-wrap">

                <!-- START WIDGETS -->
                <div class="row">
                    <div class="col-md-3">

                        <!-- START WIDGET SLIDER -->
                        <div class="widget widget-default widget-carousel">
                            <div class="owl-carousel" id="owl-example">
                                <div>
                                    <div class="widget-title">Total Messages</div>
                                    <div class="widget-subtitle"></div>
                                    <!-- <div class="widget-subtitle">27/08/2014 15:23</div> -->
                                    <div id ="total" class="widget-int">3,548</div>
                                </div>
                                <div>
                                    <div class="widget-title">Valid</div>
                                    <div class="widget-subtitle"></div>
                                    <!-- <div class="widget-subtitle">Visitors</div> -->
                                    <div id="valid"class="widget-int">1,695</div>
                                </div>
                                <!-- <div>
                                        <div class="widget-title">New</div>
                                        <div class="widget-subtitle">Visitors</div>
                                        <div class="widget-int">1,977</div>
                                    </div> -->
                            </div>
                            <div class="widget-controls">
                                <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                            </div>
                        </div>
                        <!-- END WIDGET SLIDER -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET MESSAGES -->
                        <div class="widget widget-default widget-item-icon">
                            <div class="widget-item-left">
                                <span class="fa fa-envelope"></span>
                            </div>
                            <div class="widget-data">
                                <div class="widget-int num-count">48</div>
                                <div class="widget-title">New Notifications</div>
                                <!-- <div class="widget-subtitle">In your mailbox</div> -->
                            </div>
                            <div class="widget-controls">
                                <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                            </div>
                        </div>
                        <!-- END WIDGET MESSAGES -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET REGISTRED -->
                        <div class="widget widget-default widget-item-icon">
                            <div class="widget-item-left">
                                <span class="fa fa-rss"></span>
                            </div>
                            <div class="widget-data">
                                <div class="widget-int num-count">125</div>
                                <div class="widget-title">Connected</div>
                                <div class="widget-subtitle">Device in network</div>
                            </div>
                            <div class="widget-controls">
                                <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="top" title="Remove Widget"><span class="fa fa-times"></span></a>
                            </div>
                        </div>
                        <!-- END WIDGET REGISTRED -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET CLOCK -->
                        <div class="widget widget-info widget-padding-sm">
                            <div class="widget-big-int plugin-clock">00:00</div>
                            <div class="widget-subtitle plugin-date">Loading...</div>
                            <div class="widget-controls">
                                <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="left" title="Remove Widget"><span class="fa fa-times"></span></a>
                            </div>
                            <div class="widget-buttons widget-c3">
                                <div class="col">
                                    <a href="#"><span class="fa fa-clock-o"></span></a>
                                </div>
                                <div class="col">
                                    <a href="#"><span class="fa fa-bell"></span></a>
                                </div>
                                <div class="col">
                                    <a href="#"><span class="fa fa-calendar"></span></a>
                                </div>
                            </div>
                        </div>
                        <!-- END WIDGET CLOCK -->

                    </div>
                </div>
                <!-- END WIDGETS -->

                <div class="row">
                    <!-- START TEMPERATURE CHART -->
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Temperature Chart</h3>
                            </div>
                            <div class="panel-body">
                                <canvas id="tempChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                        <!-- END Temperature CHART -->

                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Humidity Chart</h3>
                            </div>
                            <div class="panel-body">
                                <canvas id="humidChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                        <!-- END Temperature CHART -->

                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Air Quality Chart</h3>
                            </div>
                            <div class="panel-body">
                            <canvas id="airChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                        <!-- END Temperature CHART -->

                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">

                        <!-- START USERS ACTIVITY BLOCK -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Vibration</h3>
                                    <span>Triaxial</span>
                                </div>

                            </div>
                            <div class="panel-body padding-0">
                            </canvas><canvas id="vibChart"></canvas>
                            </div>
                        </div>
                        <!-- END USERS ACTIVITY BLOCK -->

                    </div>
                    <div class="col-md-4">

                        <!-- START VISITORS BLOCK -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Messages</h3>
                                    <span>Classified</span>
                                </div>

                            </div>
                            <div class="panel-body padding-0">
                            </canvas><canvas id="pieChart"></canvas>
                            </div>
                        </div>
                        <!-- END VISITORS BLOCK -->

                    </div>
					
                    <div class="col-md-4">
                        <div class="panel-heading">
                            <div class="panel-title-box" >
                                <h3>Air Quality</h3>
                                <span>Air Quality in your City</span>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-body padding-0">
                                    <div class="chart-holder" id="map" ></div>
									<div id="map-canvas"></div>
                                </div>
                            </div>
                        </div>
						  <!--<div id="map"></div>
						  <div id="map-canvas"></div>-->
                    </div>
                </div>



                <!-- <div class="panel panel-default">
                                <div class="panel-body padding-0">
                                    <div class="chart-holder" id="dashboard-line-1" style="height: 200px;"></div>
                                </div>
                            </div> -->



            </div>
        </div>
    </div>
    <!-- END PAGE CONTAINER -->

    <!-- MESSAGE BOX-->
    <div class="message-box animated fadeIn" data-sound="alert" id="mb-signout">
        <div class="mb-container">
            <div class="mb-middle">
                <div class="mb-title"><span class="fa fa-sign-out"></span> Log <strong>Out</strong> ?</div>
                <div class="mb-content">
                    <p>Are you sure you want to log out?</p>
                    <p>Press No if youwant to continue work. Press Yes to logout current user.</p>
                </div>
                <div class="mb-footer">
                    <div class="pull-right">
                        <a href="pages-login.html" class="btn btn-success btn-lg">Yes</a>
                        <button class="btn btn-default btn-lg mb-control-close">No</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END MESSAGE BOX-->

    <!-- START PRELOADS -->
    <audio id="audio-alert" src="audio/alert.mp3" preload="auto"></audio>
    <audio id="audio-fail" src="audio/fail.mp3" preload="auto"></audio>
    <!-- END PRELOADS -->

    <!-- START SCRIPTS -->
    <!-- START PLUGINS -->
    <script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script> 
    <script type="text/javascript" src="js/plugins/jquery/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>


    <script type='text/javascript' src='js/plugins/noty/jquery.noty.js'></script>
    <script type='text/javascript' src='js/plugins/noty/layouts/topCenter.js'></script>
    <script type='text/javascript' src='js/plugins/noty/layouts/topLeft.js'></script>
    <script type='text/javascript' src='js/plugins/noty/layouts/topRight.js'></script>

    <script type='text/javascript' src='js/plugins/noty/themes/default.js'></script>

    <!-- END PLUGINS -->
    <script type="text/javascript" src="js/demo_dashboard.js"></script>
    <script type="text/javascript" src="js/customJS.js"></script>
    <!-- START TECHO JS -->
    <script type="text/javascript">
    $(document).ready(function() {
      vibData('old', '');
      tempData('old', '');
      humidData('old','' );
      airData('old','' );
      pieData('old','' );
    });
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    var messageCount = 0;
    var socket = io.connect('http://192.168.2.117:3000');
    socket.on('connect', function(data) {

      socket.on('techo_vib', function(data) {
        var time = new Date().toLocaleTimeString();
        messageCount = messageCount + 1;
        vibData('new',data,time);
          });

          socket.on('techo_climate', function(data) {
            messageCount = messageCount+1;
            console.log(messageCount);
            document.getElementById("total").innerHTML = messageCount;
            document.getElementById("valid").innerHTML = messageCount;
            var time = new Date().toLocaleTimeString();
            console.log(data);
            tempData('new', data[0],time);
            humidData('new',data[1],time );
            airData('new',data[2],time );


if (data[1] > 80) {
  noty({text: 'Humidity is High', layout: 'topRight', type: 'warning'});
}else if (data[1] > 90) {
  noty({text: 'Humidity is High', layout: 'topRight', type: 'error'});
}else if (data[0]>30) {
  noty({text: 'Temperature is High', layout: 'topRight', type: 'warning'});
}else if (data[0]>35) {
  noty({text: 'Temperature is High', layout: 'topRight', type: 'error'});
}else if (data[2] > 400) {
  noty({text: 'Air Quality is Poor', layout: 'topRight', type: 'warning'});
}else if (data[2] > 700) {
  noty({text: 'Air Quality is worst', layout: 'topRight', type: 'error'});
}
          });
    });
</script>

    <!-- END TECHO JS -->

    <!-- START THIS PAGE PLUGINS-->

    <script type='text/javascript' src='js/plugins/icheck/icheck.min.js'></script>
    <script type="text/javascript" src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
    <script type="text/javascript" src="js/plugins/scrolltotop/scrolltopcontrol.js"></script>

    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'></script>
    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'></script>
    <script type='text/javascript' src='js/plugins/bootstrap/bootstrap-datepicker.js'></script>
    <script type="text/javascript" src="js/plugins/owl/owl.carousel.min.js"></script>

    <script type="text/javascript" src="js/plugins/moment.min.js"></script>
    <script type="text/javascript" src="js/plugins/daterangepicker/daterangepicker.js"></script>
    <!-- END THIS PAGE PLUGINS-->

    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/actions.js"></script>
	
    <!-- END TEMPLATE -->
    <!-- END SCRIPTS -->
	
	<!--BEGIN AMBEE INTEGRATION -->
	<script>
     

      var map, heatmap;

      function initMap() {
        //alert("Reloading map");
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 13,

          center: {lat: 12.972442, lng: 77.580643},
          mapTypeId: 'roadmap'
        });

        getPoints();

        //  heatmap.set('gradient', 'rgba(0, 0, 255, 1)');
      //  console.log("In caller metod",getPoints());
    /*    heatmap = new google.maps.visualization.HeatmapLayer({
          data: getPoints(),
          map: map
        });*/
      }

      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

      function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
      }

      function changeRadius() {
        heatmap.set('radius', heatmap.get('radius') ? null : 20);
      }

      function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
      }

      // Heatmap data: 500 Points
      function getPoints() {
        console.log("Reloading map");

        $.ajax({
          url: 'http://collector.getambee.co/api/fetch-aggregation?lng=-122.419416&lat=37.7749&precision=2&radius=200&days=5',
          //url: 'http://collector.getambee.co/api/fetch-aggregation?lng=77.580643&lat=12.972442&precision=2&radius=50&days=10',
          type: 'post',
          headers: {
               //If your header name has spaces or any other char not appropriate
              "Authorization": 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIwLCJlbWFpbCI6ImthcnRoaWtleWFuLnByYWthc2hAdGVjaG9sdXRpb24uY29tIiwiZmlyc3ROYW1lIjoiS2FydGhpa2V5YW4iLCJsYXN0TmFtZSI6IlByYWthc2giLCJpYXQiOjE1MTI0NTQxMzgyMDYsImV4cCI6MTUxMzY2MzczODIwNiwianRpIjoiMjBmOWMwNjAzMGRjMzFmMTU0YTAzNDA2YzIwYTVlNDQifQ==.R15WoyDG/z4+6fXs4tBc44J7i82Nsqw21pnxEh/CZ+OpY52y2f4/pEnxEYgMK6wgvEz+F94EqKLb8jYDerUhWzp4QMhIk1CUMWvntxGJz+Rz2ZvGRlbSjxEKn4OiVZmRiwhYdix+rTuukOkyMG8s7Ne8fzC0Ej6uTzxL3fjIlzmwtewUcnQ0AEBv8T8SQx30YURS1zU9A6s3q7nEUINZh9SJxzcA/IT4jhtJeUAGWgqtgF8LC60mVZHAY2WemOaMuyIB8DvvNXSL7anaWG0vNeArBf05BcJj+j+J9AGQyf+aUc/NU8kNL6L1IeObACjza8zhnMrQXVHdeBC/x+9ms+8i13HfvcWYZtKYxCBFnk97MwjV670wvT4cmQKoBi87Ow=='  //for object property name, use quoted notation shown in second
          },
          dataType: 'json',
          success: function (data) {
            var mapVals=new Array();

            if(data.data.length ==0 ){

              map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,

                center: {lat: 12.972442, lng: 77.580643},
                mapTypeId: 'roadmap'
              });

              $.ajax({
              //  url: 'http://collector.getambee.co/api/fetch-aggregation?lng=-122.419416&lat=37.7749&precision=2&radius=25&days=1',
                url: 'http://collector.getambee.co/api/fetch-aggregation?lng=77.580643&lat=12.972442&precision=2&radius=50&days=10',
                type: 'post',
                headers: {
                     //If your header name has spaces or any other char not appropriate
                    "Authorization": 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIwLCJlbWFpbCI6ImthcnRoaWtleWFuLnByYWthc2hAdGVjaG9sdXRpb24uY29tIiwiZmlyc3ROYW1lIjoiS2FydGhpa2V5YW4iLCJsYXN0TmFtZSI6IlByYWthc2giLCJpYXQiOjE1MTI0NTQxMzgyMDYsImV4cCI6MTUxMzY2MzczODIwNiwianRpIjoiMjBmOWMwNjAzMGRjMzFmMTU0YTAzNDA2YzIwYTVlNDQifQ==.R15WoyDG/z4+6fXs4tBc44J7i82Nsqw21pnxEh/CZ+OpY52y2f4/pEnxEYgMK6wgvEz+F94EqKLb8jYDerUhWzp4QMhIk1CUMWvntxGJz+Rz2ZvGRlbSjxEKn4OiVZmRiwhYdix+rTuukOkyMG8s7Ne8fzC0Ej6uTzxL3fjIlzmwtewUcnQ0AEBv8T8SQx30YURS1zU9A6s3q7nEUINZh9SJxzcA/IT4jhtJeUAGWgqtgF8LC60mVZHAY2WemOaMuyIB8DvvNXSL7anaWG0vNeArBf05BcJj+j+J9AGQyf+aUc/NU8kNL6L1IeObACjza8zhnMrQXVHdeBC/x+9ms+8i13HfvcWYZtKYxCBFnk97MwjV670wvT4cmQKoBi87Ow=='  //for object property name, use quoted notation shown in second
                },
                dataType: 'json',
                success: function (data) {
                  processReturnData(data);
                }});
            }else{

              map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,

                center: {lat: 37.7749, lng: -122.419416},
                mapTypeId: 'roadmap'});
                processReturnData(data);
            }

            }
        });

/*
        return [
          {location: new google.maps.LatLng(12.972442, 77.580643), weight: 0.5},
        {location: new google.maps.LatLng(13.0280, 77.5409), weight: 2},
        {location: new google.maps.LatLng(13.0031, 77.5643), weight: 3},
        {location: new google.maps.LatLng(12.9179, 77.6245), weight: 4}
      ];*/
      }
      setInterval('getPoints()', 30000);

      function processReturnData(data) {
        var mapVals=new Array();
          console.info(data);
        //  alert(data);
        //  alert(data.success);
        //  alert(data.data);
      //    val returnValues= Array();
        //  val returnValues=data.data;

            var pm25Map=new Map();
            var pm10Map=new Map();
            var pm1Map=new Map();
            var latLong=new Array();
          data.data.forEach(function(item, index, array) {
            //    console.log(item.coordinates[0], index);
                var lat =item.coordinates[1];
                var lang =item.coordinates[0];
                var key=lat+"_"+lang;

                var pm25Array=pm25Map.get(key);
                if(!pm25Array){
                  pm25Array=new Array();
                }
                pm25Array.push(item.pm25);
                pm25Map.set(key,pm25Array);

                 pm10Array=pm10Map.get(key);
                if(!pm10Array){
                  pm10Array=new Array();
                }
                pm10Array.push(item.pm10);
                pm10Map.set(key,pm10Array);


                var pm1Array=pm1Map.get(key);
                if(!pm1Array){
                  pm1Array=new Array();
                }
                pm1Array.push(item.pm1);
                pm1Map.set(key,pm1Array);

                if(!latLong.includes(key)){
                  latLong.push(key);
                }

            //    console.log('latitude is',lat);
            //    console.log('longitude is',lang);
              /*  item.coordinates.forEach(function(coordvalue, index, array) {

                  if(index ==1){
                    lat=coordvalue;
                  }else{
                    lang=coordvalue;
                  }
                })*/

                //var obj={location: new google.maps.LatLng(lat, lang), weight: 0.5};
                //mapVals.push(obj);

              });
              //console.log(mapVals);
            //  return mapVals;

               var averagepm25Map=new Map();
               var averagepm10Map=new Map();
               var averagepm1Map=new Map();

               pm25Map.forEach(function(value, key) {
                 var sum = value.reduce(function(a, b) { return a + b; });
                 var avg = sum / value.length;
                 averagepm25Map.set(key,avg);
              });
              pm10Map.forEach(function(value, key) {
                var sum = value.reduce(function(a, b) { return a + b; });
                var avg = sum / value.length;
                averagepm10Map.set(key,avg);
             });

             pm1Map.forEach(function(value, key) {
               var sum = value.reduce(function(a, b) { return a + b; });
               var avg = sum / value.length;
               averagepm1Map.set(key,avg);
            });

            latLong.forEach(function(item, index, array){

                var pm25=averagepm25Map.get(item);
                var pm10=averagepm10Map.get(item);
                var pm1=averagepm1Map.get(item);
                var coordvalues=item.split("_");
                var weight =1;
                if(pm1 > 50 && pm10 > 75 && pm25>100 ){
                    weight=4;
                }else if( pm1 <50 && (pm10 > 75 && pm25>100)){
                  weight =3 ;
                }else if( (pm1 <50 && (pm10 > 75 || pm25>100)) || (pm1 > 50) ) {
                  weight =2;
                }

                var obj={location: new google.maps.LatLng(coordvalues[0], coordvalues[1]), weight:weight};
                mapVals.push(obj);

            });

            heatmap = new google.maps.visualization.HeatmapLayer({
                    data: mapVals,
                    map: map
                  });
                  heatmap.set('radius',  20);
                  heatmap.set('opacity',  0.8);


        }



    </script>
	<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADZvM2zIk8So9l_RljbwUh9LSm01CY1SA&libraries=visualization&callback=initMap">
    </script>
	<!--BEGIN AMBEE INTEGRATION -->
</body>

</html>
